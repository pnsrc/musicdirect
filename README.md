# MusicDirect

Веб-сервер на Go для воспроизведения музыки с Яндекс.Музыки. Позволяет воспроизводить музыку без рекламы и ограничений с активной подпиской Яндекс.Плюс.

## Возможности
- Воспроизведение музыки с Яндекс.Музыки
- Добавление треков в плейлист (локально)
- Управление проигрыванием треков
- Недо API для работы с MusicDirect (пока что только для добавления треков в плейлист, и управление плейлистом)
- Поддержка Multimedia Keys (горячие клавиши для управления проигрыванием музыки)

## TODO
1. Добавить возможность сохранение плейлистов на яндекс музыке
2. Добавить возможность создания плейлистов на сервере
3. Реализовать работу медиаресивера (чтобы можно было управлять воспроизведением с телефона, либо передавать звук на другие устройства)
4. Добавить возможность воспроизведения музыки с других источников (например с ВК)
5. Улучшить дизайн
6. Разобраться с горячим добавлением треков в плейлист (чтобы не перезагружать страницу) и не сбрасывать текущий играющий трек
7. Сделать так, чтобы при перемещении трека в плейлисте не сбрасывался текущий играющий трек, а также трек не переставал играть
8. Безопасность доступа к серверу (логин/пароль, либо двухфакторная аутентификация)
9. Сохранение настроек в бд
10. Разделить файл main.go на несколько файлов, чтобы было удобнее работать ну и чтобы было красиво, а то один файл на 700 строк это не красиво, который и веб сервер и работа с бд и работа с яндекс музыкой, это все надо разделить
11. Телеграм бот для управления музыкой, и прием новых треков
12. Фантазия, но может быть сделать некую штуку для Raspberry Pi, чтобы можно было управлять музыкой, и чтобы музыка играла на колонках, которые подключены к Raspberry Pi


## Требования

- Go 1.16 или выше

## Установка и запуск

1. Установите Go, если еще не установлен:
MacOS:
```bash
brew install go
```
Windows:
Скачайте и установите с официального сайта: https://golang.org/dl/ или через [chocolatey](https://chocolatey.org/):
```bash
choco install golang
```
Debian/Ubuntu:
```bash
sudo apt install golang
```

Fedora:
```bash
sudo dnf install golang
```

Arch:
```bash
sudo pacman -S go
```

2. Установите зависимости:
```bash
go mod download
```

3. Запустите сервер:
```bash
go run main.go
```

4. Откройте браузер и перейдите по адресу: http://localhost:8080

## API

API на стадии разработки, доступность следующих методов не гарантируется.

### Получение плейлиста
```bash
curl -X GET http://localhost:8080/api/playlist
```

### Добавление трека в плейлист
```bash
curl -X POST http://localhost:8080/api/playlist/add -d '{"track_id": "123456"}'
```

### Удаление трека из плейлиста
```bash
curl -X POST http://localhost:8080/api/playlist/remove -d '{"track_id": "123456"}'
```

## Пояснения за не понятные страницы и моменты, вроде как FAQ

### Страница "DEBUG"
На этой странице можно увидеть информацию о текущей системе, версии Go, версии MusicDirect, а также информацию о текущей авторизации в Яндекс.Музыке

### Страница "Get Track"
На этой странице можно получить информацию о треке по его ID

### Почему код монолитный?
Я просто практикую Go и мне было интересно поработать с GoLang и реализовать вот этот проект, поэтому я не стал разбивать код на несколько файлов, но в будущем я это сделаю.

### Почему нет поддержки ВК?
Мне не интересен ВК, поэтому я не буду его поддерживать, но если у вас есть желание добавить поддержку ВК, то вы можете сделать это самостоятельно и сделать pull request, я буду рад добавить вашу реализацию в проект.

### Почему нет поддержки Spotify?
Высокие требования к API Spotify, а также отсутствие активной подписки на Spotify не позволяют мне добавить поддержку Spotify, но если у вас есть активная подписка на Spotify и вы хотите добавить поддержку Spotify, то вы можете сделать это самостоятельно и сделать pull request, я буду рад добавить вашу реализацию в проект.

### Почему я не могу загрузить треки на сервер?
А не предусмотренно, вы можете залить на Яндекс Музыку и добавить треки в плейлист, скормив ID трека, но в будущем я добавлю возможность загрузки треков на сервер.

### У меня возникли проблемы с установкой, что делать?
Возможно проблема с иницилизацией БД, попробуйте удалить файл `settings.db` и перезапустить сервер, если проблема не решится, то попробуйте использовать примерную таблицу, которая находится в папке `db`, если и это не поможет, то пишите в Issues, я постараюсь помочь вам.

### Проблемы в работе
Если у вас возникли проблемы в работе MusicDirect, то скопируйте логи и отправьте их в Issues, я постараюсь помочь вам.

## Использование

1. Вставьте ссылку на трек из Яндекс.Музыки
2. Нажмите "Воспроизвести"
3. Наслаждайтесь музыкой!

## Для работы потребуеться токен Яндекс.Музыки

1. Получите токен на странице https://oauth.yandex.ru/authorize?response_type=token&client_id=23cabbbdc6cd418abb4b39c32c41195d
2. Вставьте токен в поле "Токен" и нажмите "Сохранить"
3. Также не забудьте вставить свой ID в поле "ID пользователя"

### Сторонние библиотеки
- [github.com/mattn/go-sqlite3](https://github.com/mattn/go-sqlite3) - MIT License
  SQLite драйвер для Go с поддержкой database/sql
- [pkg.botr.me/yamusic](https://pkg.botr.me/yamusic) - MIT License
  Клиент для работы с API Яндекс.Музыки

